version: '3.7'
services:
 elasticsearch:
   image: elasticsearch:8.13.0
   container_name: elasticsearch
   volumes:
    - elastic-data:/usr/share/elasticsearch/data
   environment:
     - discovery.type=single-node
     - xpack.security.enabled=false
   ports:
     - "9200:9200"
     
 logstash:
   image: logstash:8.13.0
   container_name: logstash
   volumes:
     - ./logstash/:/logstash_dir
   command: logstash -f /logstash_dir/logstash.conf
   ports:
     - "5000:5000"
   depends_on:
     - elasticsearch

 kibana:
   image: kibana:8.13.0
   container_name: kibana
   ports:
     - "5601:5601"
   depends_on:
     - elasticsearch

 httpd:
    image: httpd:latest
    depends_on:
      - logstash
    ports:
      - 80:80
    logging:
      driver: gelf
      options:
        # Use udp://host.docker.internal:12201 when you are using Docker Desktop for Mac/Linux
        # docs: https://docs.docker.com/docker-for-mac/networking/#i-want-to-connect-from-a-container-to-a-service-on-the-host
        # issue: https://github.com/lvthillo/docker-elk/issues/1
        gelf-address: "udp://localhost:12201"

networks:
 default:
   driver: bridge

volumes:
  elastic-data:
    driver: local


  
    

